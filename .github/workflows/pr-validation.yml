name: PR Validation

on:
  pull_request:
    branches: [ main, develop ]

jobs:
  validate-pr:
    name: Validate Pull Request
    runs-on: ubuntu-latest
    
    steps:
      - name: ğŸ“¥ Checkout PR code
        uses: actions/checkout@v4
        with:
          fetch-depth: 0
      
      - name: ğŸ”§ Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: '18'
          cache: 'npm'
      
      - name: ğŸ“¦ Install dependencies
        run: npm ci
      
      # Validation du titre de la PR
      - name: ğŸ“ Validate PR title
        uses: amannn/action-semantic-pull-request@v5
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
        with:
          types: |
            feat
            fix
            docs
            style
            refactor
            test
            chore
        continue-on-error: true
      
      # Tests rapides pour la PR
      - name: ğŸ§ª Quick tests
        run: npm test
      
      # VÃ©rification des fichiers modifiÃ©s
      - name: ğŸ“‹ Check modified files
        run: |
          echo "Files changed in this PR:"
          git diff --name-only origin/main...HEAD
          
          # VÃ©rifier si des tests ont Ã©tÃ© ajoutÃ©s pour les nouveaux fichiers
          if git diff --name-only origin/main...HEAD | grep -E '\.(js|ts)$' | grep -v test; then
            echo "âš ï¸  Code files modified. Please ensure tests are updated."
          fi
      
      # Commentaire automatique sur la PR
      - name: ğŸ’¬ Comment PR
        uses: actions/github-script@v6
        with:
          script: |
            const { owner, repo, number } = context.issue;
            
            await github.rest.issues.createComment({
              owner,
              repo,
              issue_number: number,
              body: `
              ## ğŸ¤– Validation automatique
              
              âœ… Tests passÃ©s avec succÃ¨s  
              âœ… DÃ©pendances vÃ©rifiÃ©es  
              âœ… Code analysÃ©  
              
              **PrÃªt pour la review !** ğŸ‘€
              `
            });
        continue-on-error: true
